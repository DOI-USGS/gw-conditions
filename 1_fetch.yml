target_default: 1_fetch

packages:
  - dataRetrieval
  - dplyr
  - sf

sources:
  - 1_fetch/src/fetch_nwis.R
  - 1_fetch/src/fetch_gwcrn.R

targets:

  1_fetch:
    depends:
      - 1_fetch/out/gw_data.rds
      - 1_fetch/out/gw_crn_data.rds

##-- All GW sites with continuous data --##
  
  gw_sites:
    command: fetch_gw_sites(start_date, end_date, gw_param_cd)
  gw_site_info:
    command: fetch_gw_site_info(gw_sites)
  1_fetch/out/gw_data.rds:
    command: fetch_gw_data(target_name, gw_sites, start_date, end_date, gw_param_cd, stat_cd = I("00003"), 200)
  
##-- Climate Response Network sites --##
  
  1_fetch/tmp/gw_crn_sites.zip:
    command: download.file(
      destfile = target_name,
      url = I('https://groundwaterwatch.usgs.gov/dws_maps/covers/shapefiles/crn_wells.zip'))
  gw_crn_sites_sf:
    command: unzip_and_read_shp(zipfile = '1_fetch/tmp/gw_crn_sites.zip', tmp_dir = I('1_fetch/tmp'))
  gw_crn_sites:
    command: extract_crn_sites(gw_crn_sites_sf)
  
  1_fetch/out/gw_crn_data.rds:
    command: fetch_gw_data(target_name, gw_crn_sites, start_date, end_date, gw_param_cd, stat_cd = I("00001"), 200)
